(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();let ue=!1;function Me(){return ue}function fe(e){ue=e}let de=null;function P(){return de}function S(e){de=e}let me=1;function L(){return me}function $e(e){me=e}let Ne=40;function Oe(){return Ne}let q=5;function Pe(){return q}let Re=5,ye=null;function V(){return ye}function Ue(e){ye=e}let j=5,he=5;function pe(){return he}function Ge(e){he=e}let ve=!1;function ie(){return ve}function h(e){ve=e}let ge="titleScreen";function ze(){return ge}function E(e){ge=e}let K=[];function c(){return K}function Ve(e){K.push(e)}function je(){K=[]}let Ee=null;function F(){return Ee}function B(e){Ee=e}let oe=999;function se(){return oe++,oe}const be=document.querySelector(".gameView"),Ae=document.querySelector("#startScreen"),W=document.querySelector("#startBtn"),we=document.querySelector("#shopBtn"),Le=document.querySelector(".battleScreen");document.querySelector(".titleScreen");document.querySelector(".shopScreen");const k=[];for(let e=1;e<=q;e++){const t=document.querySelector(`#enemy${e}`);t&&k.push(t)}const Se=document.querySelector(".noEnemy"),J=[];for(let e=1;e<=j;e++){const t=document.querySelector(`#hero${e}`);t&&J.push(t)}const Be=document.querySelector(".mainMenu"),I=document.querySelector("#attackBtn"),y=document.querySelector("#abilityBtn"),M=document.querySelector("#defendBtn"),ke=document.querySelector("#returnBtn"),m=[];for(let e=1;e<=j;e++){const t=document.querySelector(`#heroAction${e}`);t&&m.push(t)}const p=[];for(let e=1;e<=j;e++){const t=document.querySelector(`#heroTarget${e}`);t&&p.push(t)}class w{constructor(t,n,i,o,s,r,u){this.name=t,this.hpMax=n,this.hp=n,this.damage=i,this.defense=o,this.speed=s,this.threatLevel=r,this.id=u,this.isAlive=!0,this.ability=null,this.posture="normal",this.status=[],this.buffs=[]}attack(t){let n=t.posture==="defend"?t.defense*2:t.defense;const i=this.damage-n;let o=0;return i>0&&(o=t.takeDamage(i)),o}takeDamage(t){return this.hp-=t,this.hp<=0&&(this.hp=0,this.isAlive=!1),t}}function Ke(){let e=0;for(let t=0;t<pe();t++){const n=l[t].name;e=t+1;const i=document.querySelector("#heroNameDisplay"+e);i&&(i.value=n)}}function Q(e=null,t=!1){e===null&&(e=0),e++;for(let n=1;n<=l.length;n++){let i=document.getElementById("hero"+n);i&&i.classList.remove("selected")}t===!0?We(e):Fe(e),R(e)}function Fe(e){for(let t=0;t<=l.length;t++){let n=e+t-1,i=e+t,o=document.getElementById("hero"+i);if(o&&l[n].isAlive===!0){o.classList.add("selected");break}}}function We(e){for(let t=0;t<=e;t++){let n=e-t-1,i=e-t,o=document.getElementById("hero"+i);if(o&&l[n].isAlive===!0){o.classList.add("selected");break}}}function X(e){e++,document.getElementById("hero"+e).classList.add("validate")}function Je(e){const t=e+1;document.getElementById("hero"+t).classList.remove("validate")}function Qe(){for(let e=1;e<=l.length;e++){const t=document.getElementById("hero"+e);t&&(t.classList.remove("selected"),t.classList.remove("validate"))}}function R(e=null){if(e===null)for(let t=0;t<l.length;t++)m[t].value=null,p[t].value=null;else e--,m[e].value=null,p[e].value=null}async function b(e){const t=l[e];e++;const n=document.querySelector(`#heroLife${e}`);n&&(n.style.width=`${t.hp/t.hpMax*100}%`)}function le(e){e.classList.add("attackHero"),setTimeout(()=>{e.classList.remove("attackHero")},300)}const v={healMono:{name:"Reconstitution",targetType:"self",cooldown:3,remainingCooldown:0,priority:0,duration:1,effect:function(e){e.hp=e.hpMax,b(l.indexOf(e)),this.remainingCooldown=this.cooldown},endEffect:function(e){}},healMulti:{name:"Revitalisation",targetType:"team",cooldown:5,remainingCooldown:0,priority:0,duration:1,effect:function(e){for(let t=0;t<e.length;t++)e[t].isAlive===!0&&(e[t].hp+=5,e[t].hp>e[t].hpMax&&(e[t].hp=e[t].hpMax),b(t));this.remainingCooldown=this.cooldown},endEffect:function(e){}},tank:{name:"Provocation",targetType:"self",cooldown:2,remainingCooldown:0,priority:1,duration:1,effect:function(e){e.buffs.push({name:"tank",duration:this.duration}),e.defense*=2,e.threatLevel*=2,e.posture="defend",this.remainingCooldown=this.cooldown},endEffect:function(e){e.defense/=2,e.threatLevel/=2,e.posture="normal"}},poison:{name:"Toxcine",targetType:"enemy",cooldown:3,remainingCooldown:0,priority:0,duration:1,effect:function(e,t){t.status.push("poisoned"),this.remainingCooldown=this.cooldown},endEffect:function(e){}}},l=[new w("Areles",10,5,4,2,2,1),new w("Knight",10,5,5,1,5,2),new w("Cleric",10,5,2,2,1,3),new w("Rogue",10,5,1,4,1,4)];l[0].ability=v.healMono;l[1].ability=v.tank;l[2].ability=v.healMulti;l[3].ability=v.poison;class ae{constructor(t,n,i,o,s,r,u){this.name=t,this.hpMax=n,this.hp=n,this.damage=i,this.defense=o,this.speed=s,this.money=r,this.id=null,this.isAlive=!0,this.ability=null,this.label=null,this.personality=u,this.posture="normal",this.status=[],this.buffs=[]}updateBuffs(){this.buff=this.buff.filter(t=>(t.duration-=1,t.duration<=0?(t.effect==="tank"&&(this.defense=t.initialDefense,this.threatLevel=t.initialThreatLevel,this.posture="normal"),!1):!0))}attack(t){let n=t.posture==="defend"?t.defense*2:t.defense;const i=this.damage-n;let o=0;return i>0&&(o=t.takeDamage(i)),o}takeDamage(t){return this.hp-=t,this.hp<=0&&(this.hp=0,this.isAlive=!1),t}determineAction(t){const n=Math.random()*100;let i;return t==="Agressif"?n<70?i="attack":n<85?i="ability":i="defend":t==="Passif"?n<20?i="attack":n<40?i="ability":i="defend":t==="Tactique"&&(n<40?i="attack":n<70?i="ability":i="defend"),i}}const Xe=[class extends ae{constructor(t){super("Lézard",10,10,2,4,1,"Agressif"),this.id=t}},class extends ae{constructor(t){super("Rat",10,10,1,1,1,"Agressif"),this.id=t}}];let f;function Ye(){if(f=L(),f>=1&&f<=4){je();const e=Ze(Xe);B(e)}else f==5?(console.log("Un ennemi a été trouvé !"),console.log("Un coffre a été trouvé !")):f>=6&&f<=9?console.log("Un puissant ennemi a été trouvé !"):f==10||f>=11&&f<=14?console.log("Un boss a été trouvé !"):f==15?(console.log("Un boss a été trouvé !"),console.log("Un coffre a été trouvé !")):(f>=16&&f<=19||f==20)&&console.log("Le jeu est terminé !")}function Ze(e){let t=Re-5,n=e.length-1;Ue(Math.floor(Math.random()*q)+1);let i=V();for(;i>=1;){const r=e[Math.floor(Math.random()*(n-t+1)+t)],u=se(),d=new r(u);Ve(d),i--}const o=e[Math.floor(Math.random()*(n-t+1)+t)],s=se();return new o(s),c()[0]}function _e(e,t){t++;let n;n=document.getElementById("enemy"+t),n.classList.remove("dead")}let g={};function et(e){return g[e]||(g[e]=0),g[e]++,`${e}${g[e]}`}function tt(){let e=0;for(let t=0;t<V();t++){const n=et(c()[t].name);c()[t].label=n,e=t+1;const i=document.querySelector("#enemyNameDisplay"+e);i&&(i.value=n),Y(t),_e("enemy",t)}g={}}function Y(e){const t=c()[e];e++;const n=document.querySelector(`#enemyLife${e}`);n&&(n.style.width=`${t.hp/t.hpMax*100}%`)}function U(e,t=null){for(let n=1;n<=q;n++){const i=document.getElementById("enemy"+n),o=document.getElementById("enemy"+t);if(i){if(e==="removeAll"||e==="select")i.classList.remove("selected");else if(e==="startSelection"&&c()[n-1].isAlive){i.classList.add("selected");return}}e==="select"&&o&&o.classList.add("selected")}}function nt(e){e.classList.add("attackEnemy"),setTimeout(()=>{e.classList.remove("attackEnemy")},300)}function it(){st(),lt(),W.value="Arrêter",we.style.display="none",Le.style.display="flex"}function ot(){Se.style.display="flex";for(let e=c().length-1;e>=0;e--)k[e].style.display="none";Be.style.display="flex";for(let e=l.length;e>=0;e--)J[e].style.display="none";W.value="Démarrer",we.style.display="flex",Le.style.display="none"}function st(){const e=document.querySelector(".topBar");Se.style.display="none";for(let t=0;t<Pe();t++)t<V()?k[t].style.display="flex":k[t].style.display="none";e.classList.remove("showEnemy"),e.classList.add("showEnemy")}function lt(){Be.style.display="none";for(let e=0;e<pe();e++)J[e].style.display="flex"}function Z(e){e===1?returnBtn.style.display="none":returnBtn.style.display="flex"}function at(){I.style.display="none",y.style.display="none",M.style.display="none",returnBtn.style.display="none"}function rt(){I.style.display="flex",y.style.display="flex",M.style.display="flex",returnBtn.style.display="flex"}function ct(){const e=document.querySelector(".grid");if(!e){console.error("L'élément .gameView n'a pas été trouvé");return}e.classList.add("shake"),setTimeout(()=>{e.classList.remove("shake")},300)}function A(e,t){t++;let n;e==="hero"?n=document.getElementById("hero"+t):n=document.getElementById("enemy"+t),n.classList.add("dead")}function ut(e,t){t++;let n;n=document.getElementById("hero"+t),n.classList.remove("dead")}function _(e){const t=document.getElementById("abilityBtn"),n=document.getElementById("cooldownText");e>0?(t.classList.add("cooldown"),n.innerText=e):(t.classList.remove("cooldown"),n.innerText="")}function G(e,t){const n=e.startsWith("hero"),i=document.querySelector(`#${e}`);if(i){const o=document.createElement("div");o.className=`floating-damage-container ${n?"hero":"enemy"}`,o.textContent=`-${t}`,i.appendChild(o),o.classList.add(n?"showHeroDamage":"showEnemyDamage"),setTimeout(()=>{o.remove()},1500)}else console.error(`Aucun conteneur de dégâts trouvé pour l'ID ${e}`)}let a=0,D=!1;const $={};let De=0,x,H,C,T;function ft(){return He(),Z(1),Q(),new Promise(e=>{a=te(),De=a,D=!1,xe(e)})}function xe(e){if(D)return;D=!0,x=()=>dt(e),H=()=>mt(e),C=()=>yt(e),T=()=>ht(),I.addEventListener("click",x),y.addEventListener("click",H),M.addEventListener("click",C),ke.addEventListener("click",T);const t=l[a].ability;y.querySelector(".button-text").innerText=t.name,_(t.remainingCooldown);for(let n=1;n<=c().length;n++){const i=document.getElementById(`enemy${n}`);i&&i.addEventListener("click",()=>pt(n))}}function dt(e){const t=c().indexOf(F());$[l[a].name]=["attack",t],X(a),ne("attack",c()[t].label),ee(e)}function mt(e){const t=l[a].ability;if(t.remainingCooldown===0){const n=c().indexOf(F());$[l[a].name]=[t,n],X(a),ne("ability",c()[n].label,t),ee(e)}}function yt(e){c().indexOf(F()),$[l[a].name]=["defend",0],X(a),ne("defend"),ee(e)}function ht(e){a=te(-1),Je(a),Q(a,!0),a===De&&Z(1);const t=l[a].ability;y.querySelector(".button-text").innerText=t.name,_(t.remainingCooldown)}function ee(e){if(a=te(1),a<l.length){xe(a),Q(a),Z();const t=l[a].ability;y.querySelector(".button-text").innerText=t.name,_(t.remainingCooldown)}else D=!1,He(),a=0,e($)}function He(){x&&I.removeEventListener("click",x),H&&y.removeEventListener("click",H),C&&M.removeEventListener("click",C),T&&ke.removeEventListener("click",T)}function pt(e){c()[e-1].isAlive===!0&&(B(c()[e-1]),U("select",e))}function te(e=0){if(e>=0){const t=a+e;for(let n=0;n+t<l.length;n++)if(l[n+t].isAlive===!0)return n+t}else for(let t=0;t<=a;t++){const n=a+e-t;if(n===0||l[n].isAlive===!0)return n}}function ne(e=null,t=null,n=null){if(n!==null&&(n.targetType==="enemy"?(m[a].value=n.name,p[a].value=t):m[a].value=n.name),e==="defend")m[a].value=e;else if(e===null)for(let i=0;i<=a;i++){const o=a-i;if(o===0||l[o].isAlive===!0)break;m[o].value=null,p[o].value=null}else e==="attack"&&(m[a].value=e,p[a].value=t)}function Ce(e,t,n,i){switch(e.targetType){case"self":e.effect(t);break;case"team":e.effect(n);break;case"enemy":e.effect(t,i);break}}function vt(e){return new Promise(t=>setTimeout(t,e))}function z(e,t){const n=e.every(o=>!o.isAlive),i=t.every(o=>!o.isAlive);return n?"Enemies":i?"Heroes":n||i}async function gt(e,t,n){const i=[...e,...t].sort((s,r)=>r.speed-s.speed);Bt(e,n),kt(e,n);for(const s of i){const r=z(e,t);if(r){S(r),h(!0),E("endScreen");break}if(s.isAlive===!0){if(e.includes(s)){if(n[s.name][2]===0){const u=n[s.name][1];Et(s,t[u],u,n[s.name][0])}}else Lt(s,e);await vt(800)}}const o=z(e,t);o&&(S(o),h(!0),E("endScreen"))}function Et(e,t,n,i){i==="attack"?bt(e,t,n):i==="defend"||At(e,t,n,i)}function bt(e,t,n){if(t.isAlive){const i=e.attack(t),o=l.findIndex(r=>r.id===e.id)+1,s=document.getElementById(`hero${o}`);G(`enemy${n+1}`,i),le(s),t.isAlive===!1&&A("enemi",n)}else if(n=wt(n),n!==null){t=c()[n];const i=e.attack(t);G(`enemy${n+1}`,i);const o=l.findIndex(r=>r.id===e.id)+1,s=document.getElementById(`hero${o}`);le(s),t.isAlive===!1&&A("enemi",n)}Y(n)}function At(e,t,n,i){Ce(i,e,l,t)}function wt(e){const t=c(),n=t.length;for(let i=1;i<n;i++){if(t[e+i]&&t[e+i].isAlive)return e+i;if(t[e-i]&&t[e-i].isAlive)return e-i}return console.log("Tous les ennemis sont morts"),null}function Lt(e,t){const n=e.determineAction(e.personality);n==="attack"?(St(e,t),e.posture="normal"):n==="ability"?e.posture="normal":n==="defend"&&(e.posture="defend")}function St(e,t){const n=t.filter(r=>r.isAlive),i=n.reduce((r,u)=>r+u.threatLevel,0);let o=null;o=Math.random()*i;let s=0;for(const r of n)if(s+=r.threatLevel,o<s){const u=e.attack(r),d=t.findIndex(O=>O.id===r.id),N=c().findIndex(O=>O.id===e.id)+1,Ie=document.getElementById(`enemy${N}`);nt(Ie),G(`hero${d+1}`,u),ct(),b(d),r.isAlive===!1&&A("hero",d);break}}function Bt(e,t){Object.keys(t).forEach(n=>{const i=t[n],o=e.find(s=>s.name===n);i[0].priority===1?(Ce(i[0],o,e),t[n].push(1)):t[n].push(0)})}function kt(e,t){Object.keys(t).forEach(n=>{const i=t[n],o=e.find(s=>s.name===n);i[0]==="defend"?o.posture="defend":o.posture="norma"})}const Dt={poisoned:{apply:e=>{e.hp-=2,e.hp<=0&&(e.hp=0,e.isAlive=!1)},duration:5}};function re(e){e.status.forEach((t,n)=>{const i=Dt[t];i&&(i.apply(e),i.duration--,i.duration<=0&&e.status.splice(n,1))})}async function xt(){for(;ie()===!1;){rt(),U("startSelection"),B();for(let n=0;n<c().length;n++)if(c()[n].isAlive){B(c()[n]);break}const e=[];for(let n=0;n<c().length;n++)c()[n].isAlive&&e.push(c()[n]);const t=await ft();if(R(),Qe(),at(),U("removeAll"),await gt(l,c(),t),await Ht(),Ct(),ie()===!0){R();break}}}async function Ht(){l.forEach((t,n)=>{const i=t.ability;t.isAlive&&(i&&i.remainingCooldown>0&&(i.remainingCooldown-=1),re(t),b(n),t.isAlive||A("hero",n))}),c().forEach((t,n)=>{const i=t.ability;t.isAlive&&(i&&i.remainingCooldown>0&&(i.remainingCooldown-=1),re(t),Y(n),t.isAlive||A("enemy",n))});const e=z(l,c());e&&(S(e),h(!0),E("endScreen"))}function Ct(){l.forEach(e=>{if(e.isAlive)for(let t=e.buffs.length-1;t>=0;t--){const n=e.buffs[t];n.duration--,n.duration<=0&&(v[n.name]?v[n.name].endEffect(e):console.error(`Ability "${n.name}" not found in abilities.`),e.buffs.splice(t,1))}})}async function Tt(){for(;Me()&&L()<=Oe();){let e=L();if(S(null),h(!1),Ye(),it(),tt(),Ke(),await xt(),P()==="Heroes")h(!1),$e(L()+1),await qt(`Stage ${e} cleared!`);else if(P()==="Enemies"){h(!0);break}}}function qt(e){return new Promise(t=>{const n=document.getElementById("transition");n.innerText=e,n.classList.add("show"),n.style.zIndex="1000",setTimeout(()=>{n.classList.add("hide"),setTimeout(()=>{n.classList.remove("show"),n.classList.remove("hide"),n.style.zIndex="-1",t()},1e3)},2e3)})}async function It(){Mt(),E("battleScreen"),fe(!0),Ge(l.length),await Tt()}function Mt(){for(let e=0;e<l.length;e++)l[e].isAlive=!0,l[e].hp=l[e].hpMax,be.style.display="grid",Ae.style.display="none",b(e),ut("hero",e)}function ce(){be.style.display="grid",Ae.style.display="none",E("TitleScreen"),fe(!1),ot()}W.addEventListener("click",async()=>{ze()!=="battleScreen"?(await It(),P()==="Enemies"&&ce()):ce()});const Te=[{name:"Héro 1",stats:"Stats pour Héro 1"},{name:"Héro 2",stats:"Stats pour Héro 2"},{name:"Héro 3",stats:"Stats pour Héro 3"}];function qe(e,t,n){const i=document.getElementById(e),o=document.getElementById(t);i.innerHTML="",o.innerHTML="",n.forEach((s,r)=>{const u=document.createElement("button");u.classList.add("tab-button"),r===0&&u.classList.add("active"),u.textContent=s.name,u.onclick=N=>$t(N,s.name,t),i.appendChild(u);const d=document.createElement("div");d.classList.add("tab-content"),r===0&&d.classList.add("active"),d.id=s.name,d.textContent=s.stats,o.appendChild(d)})}function $t(e,t,n){const i=e.target.parentElement,o=document.getElementById(n);Array.from(i.getElementsByClassName("tab-button")).forEach(s=>s.classList.remove("active")),Array.from(o.getElementsByClassName("tab-content")).forEach(s=>s.classList.remove("active")),e.target.classList.add("active"),document.getElementById(t).classList.add("active")}qe("inventoryTabs","inventoryContent",Te);qe("artifactTabs","artifactContent",Te);
